var tribe_tickets_ticket_form={};!function(s,d){var u;d.init=function(){u=s(".tribe-events-tickets, .tribe-events-tickets-tpp"),u.find(".quantity").find(".qty, .edd-input").on("change",d.on_quantity_change)},d.on_quantity_change=function(){var t=s(this),e=d.get_matching_ticket_id(this);d.ticket_uses_global_stock(e)?d.global_stock_quantity_changed(t,e):d.normal_stock_quantity_changed(t,e);var i=t.closest("form");if(i.hasClass("tribe-tickets-tpp")){var a=parseInt(t.val(),10);0<(a=isNaN(a)?0:a)?i.find('td[data-product-id]:not([data-product-id="'+e+'"])').closest("tr").find("input, button").attr("disabled","disabled").closest("tr").addClass("tribe-tickets-purchase-disabled"):i.find("input, button").removeAttr("disabled").closest("tr").removeClass("tribe-tickets-purchase-disabled")}},d.global_stock_quantity_changed=function(t,e){var i=t.val(),a=d.get_event_id(e),n=d.get_cap(e),c=d.get_global_stock(a),o=d.currently_requested_global_event_stock(a);c<o&&(i-=o-c),d.stock_mode_is_capped(e)&&n<i&&(i=n),i<=0&&(i=0),t.val(i),d.update_available_stock_counts(a)},d.normal_stock_quantity_changed=function(t,e){var i,a=t.val(),n=d.get_single_stock(e);s.isNumeric(n)&&-1!==n&&(n<a&&(a=n),t.val(a),i=n-a,u.find(".available-stock[data-product-id="+e+"]").html(i))},d.update_available_stock_counts=function(t){var e=d.get_tickets_of(t),i=d.get_global_stock(t)-d.currently_requested_global_event_stock(t);for(var a in e)if(e.hasOwnProperty(a)){i<0&&(i=0);var n=e[a];if("global"===n.mode&&u.find(".available-stock[data-product-id="+a+"]").html(i),"capped"===n.mode){var c=Math.min(i,n.cap),o=s("[data-product-id="+a+"]").find("input.tribe-ticket-quantity, .input-text.qty, input.edd-input"),_=parseInt(o.val(),10);_=isNaN(_)?0:_;var r=n.cap-_;r<0?r=0:c<r&&(r=c),u.find(".available-stock[data-product-id="+a+"]").html(r)}}},d.get_matching_ticket_id=function(t){var e=s(t).closest("[data-product-id]");if(e.length)return e.data("product-id")},d.get_ticket_property=function(t,e){if("object"!=typeof tribe_tickets_stock_data)return!1;var i=tribe_tickets_stock_data.tickets[t];return void 0!==tribe_tickets_stock_data.tickets[t]&&i[e]},d.get_tickets_of=function(t){if("object"!=typeof tribe_tickets_stock_data)return!1;var e=[];for(var i in tribe_tickets_stock_data.tickets){var a=tribe_tickets_stock_data.tickets[i];t===a.event_id&&(e[i]=a)}return e},d.currently_requested_global_event_stock=function(t){var _=0;d.get_tickets_of(t);return u.find(".available-stock").each(function(t,e){var i=s(e),a=i.data("productId"),n=tribe_tickets_stock_data.tickets[a].mode;if(-1!==["global","capped"].indexOf(n)){var c=i.parents("tr").eq(0).find(".qty, .edd-input"),o=parseInt(c.val(),10);_+=o}}),_},d.get_event_property=function(t,e){if("object"!=typeof tribe_tickets_stock_data)return!1;var i=tribe_tickets_stock_data.events[t];return"undefined"!==tribe_tickets_stock_data.events[t]&&i[e]},d.stock_mode_is_global=function(t){return"global"===d.get_mode(t)},d.stock_mode_is_capped=function(t){return"capped"===d.get_mode(t)},d.ticket_uses_global_stock=function(t){return d.stock_mode_is_capped(t)||d.stock_mode_is_global(t)},d.get_mode=function(t){return d.get_ticket_property(t,"mode")},d.get_event_id=function(t){return d.get_ticket_property(t,"event_id")},d.get_cap=function(t){return d.get_ticket_property(t,"cap")},d.get_global_stock=function(t){return d.get_event_property(t,"stock")},d.get_single_stock=function(t){return d.get_ticket_property(t,"stock")},s(function(){d.init()}),s(document).on("click",".button-events-list",function(t){t.preventDefault();var e=t.target.parentElement.action;window.location=e})}(jQuery,tribe_tickets_ticket_form);