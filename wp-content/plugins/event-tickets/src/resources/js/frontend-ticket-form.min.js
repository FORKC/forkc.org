var tribe_tickets_ticket_form={};!function(t,e){var i,a;e.init=function(){i=t(".tribe-events-tickets, .tribe-events-tickets-tpp"),a=i.find(".quantity").find(".qty, .edd-input"),a.on("change",e.on_quantity_change)},e.on_quantity_change=function(){var i=t(this),a=e.get_matching_ticket_id(this);e.ticket_uses_global_stock(a)?e.global_stock_quantity_changed(i,a):e.normal_stock_quantity_changed(i,a);var n=i.closest("form");if(n.hasClass("tribe-tickets-tpp")){var c=parseInt(i.val(),10);c=isNaN(c)?0:c,c>0?n.find('td[data-product-id]:not([data-product-id="'+a+'"])').closest("tr").find("input, button").attr("disabled","disabled").closest("tr").addClass("tribe-tickets-purchase-disabled"):n.find("input, button").removeAttr("disabled").closest("tr").removeClass("tribe-tickets-purchase-disabled")}},e.global_stock_quantity_changed=function(t,i){var a=t.val(),n=e.get_event_id(i),c=e.get_cap(i),o=e.get_global_stock(n),_=e.currently_requested_global_event_stock(n);_>o&&(a-=_-o),e.stock_mode_is_capped(i)&&a>c&&(a=c),0>=a&&(a=0),t.val(a),e.update_available_stock_counts(n)},e.normal_stock_quantity_changed=function(a,n){var c,o=a.val(),_=e.get_single_stock(n);t.isNumeric(_)&&-1!==_&&(o>_&&(o=_),a.val(o),c=_-o,i.find(".available-stock[data-product-id="+n+"]").html(c))},e.update_available_stock_counts=function(a){var n=e.get_tickets_of(a),c=e.get_global_stock(a)-e.currently_requested_global_event_stock(a);for(var o in n)if(n.hasOwnProperty(o)){c<0&&(c=0);var _=n[o];if("global"===_.mode&&i.find(".available-stock[data-product-id="+o+"]").html(c),"capped"===_.mode){var r=Math.min(c,_.cap),s=t("[data-product-id="+o+"]").find("input.tribe-ticket-quantity, .input.qty"),d=parseInt(s.val(),10);d=isNaN(d)?0:d;var u=_.cap-d;u<0?u=0:u>r&&(u=r),i.find(".available-stock[data-product-id="+o+"]").html(u)}}},e.get_matching_ticket_id=function(e){var i=t(e).closest("[data-product-id]");if(i.length)return i.data("product-id")},e.get_ticket_property=function(t,e){if("object"!=typeof tribe_tickets_stock_data)return!1;var i=tribe_tickets_stock_data.tickets[t];return"undefined"!=typeof tribe_tickets_stock_data.tickets[t]&&i[e]},e.get_tickets_of=function(t){if("object"!=typeof tribe_tickets_stock_data)return!1;var e=[];for(var i in tribe_tickets_stock_data.tickets){var a=tribe_tickets_stock_data.tickets[i];t===a.event_id&&(e[i]=a)}return e},e.currently_requested_global_event_stock=function(a){var n=0,c=(e.get_tickets_of(a),i.find(".available-stock"));return c.each(function(e,i){var a=t(i),c=a.data("productId"),o=["global","capped"],_=tribe_tickets_stock_data.tickets[c].mode;if(-1!==o.indexOf(_)){var r=a.parents("tr").eq(0).find(".qty, .edd-input"),s=parseInt(r.val(),10);n+=s}}),n},e.get_event_property=function(t,e){if("object"!=typeof tribe_tickets_stock_data)return!1;var i=tribe_tickets_stock_data.events[t];return"undefined"!==tribe_tickets_stock_data.events[t]&&i[e]},e.stock_mode_is_global=function(t){return"global"===e.get_mode(t)},e.stock_mode_is_capped=function(t){return"capped"===e.get_mode(t)},e.ticket_uses_global_stock=function(t){return e.stock_mode_is_capped(t)||e.stock_mode_is_global(t)},e.get_mode=function(t){return e.get_ticket_property(t,"mode")},e.get_event_id=function(t){return e.get_ticket_property(t,"event_id")},e.get_cap=function(t){return e.get_ticket_property(t,"cap")},e.get_global_stock=function(t){return e.get_event_property(t,"stock")},e.get_single_stock=function(t){return e.get_ticket_property(t,"stock")},t(function(){e.init()}),t(document).on("click",".button-events-list",function(t){t.preventDefault();var e=t.target.parentElement.action;window.location=e})}(jQuery,tribe_tickets_ticket_form);