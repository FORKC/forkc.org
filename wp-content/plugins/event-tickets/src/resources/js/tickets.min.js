void 0===tribe.tickets&&(tribe.tickets={}),tribe.tickets.editor={};var ticketHeaderImage=window.ticketHeaderImage||{};!function(_,p,c,n){"use strict";p("html, body");var a=p(document),m=p(document.getElementById("tribetickets"));if(0!==m.length){var e=p(document.getElementById("event_tickets")),r=p(document.getElementById("post_ID")),t=p(document.getElementById("publish")),i=m.find(".tribe-tickets-editor-blocker"),d=m.find(".spinner"),u=p(document.getElementById("tribe_panel_base")),o=p(document.getElementById("tribe_panel_edit")),s=p(document.getElementById("tribe_panel_settings")),f=["yy-mm-dd","m/d/yy","mm/dd/yy","d/m/yy","dd/mm/yy","m-d-yy","mm-dd-yy","d-m-yy","dd-mm-yy","yy.mm.dd","mm.dd.yy","dd.mm.yy"],k=f[0];n.beforeUnload=function(e){var t=!1;return"true"===u.attr("aria-hidden")&&(t=tribe_global_stock_admin_ui.nav_away_msg),e.returnValue=t},ticketHeaderImage={uploader:function(){var t=wp.media({title:HeaderImageData.title,multiple:!1,library:{type:"image"},button:{text:HeaderImageData.button}});return t.on("close",function(){var e=t.state().get("selection").toJSON();e.length&&ticketHeaderImage.render(e[0])}),t.open(),!1},render:function(e){p(document.getElementById("tribe_ticket_header_preview")).html(ticketHeaderImage.imgHTML(e)),p(document.getElementById("tribe_ticket_header_image_id")).val(e.id),p(document.getElementById("tribe_ticket_header_remove")).show(),p(document.getElementById("tribe_tickets_image_preview_filename")).show().find(".filename").text(e.filename)},imgHTML:function(e){var t='<img src="'+e.url+'" ';return t+='width="'+e.width+'" ',t+='height="'+e.height+'" ',t+="/>"}},n.panels={list:"#tribe_panel_base",ticket:"#tribe_panel_edit",settings:"#tribe_panel_settings"},n.swapPanel=function(e){var t;t=e instanceof jQuery?e:void 0!==n.panels[e]?p(n.panels[e]):u;var i=p("#event_tickets");i.trigger("before_panel_swap.tickets",{panel:t}),m.find(".ticket_panel").each(function(){p(this).attr("aria-hidden",!0)}),t.attr("aria-hidden",!1),t.is(u)?(p(_).off("beforeunload.tribe"),a.trigger("tribe.dependencies-run")):p(_).on("beforeunload.tribe",n.beforeUnload),i.trigger("after_panel_swap.tickets",{panel:t})},n.fetchPanels=function(e,t){void 0===e&&(e=[]);var i={action:"tribe-ticket-panels",notice:!1,post_id:r.val(),nonce:TribeTickets.add_ticket_nonce,data:e,is_admin:p("body").hasClass("wp-admin")};p.post(ajaxurl,i,function(e){e.success&&n.refreshPanels(e.data,t)},"json")},n.startWatchingMoveLinkIn=function(){e.find(".tribe-ticket-move-link").one("click",function(){_.setTimeout(n.listentToThickboxEvents,250)})},n.listentToThickboxEvents=function(){var e=p("#TB_window");0!==e.length&&e.one("tb_unload",function(){n.fetchPanels(null,"list")})},n.refreshPanels=function(e,t){u=p(e.list),o=p(e.ticket),s=p(e.settings),m.find(n.panels.list).replaceWith(u),m.find(n.panels.ticket).replaceWith(o),m.find(n.panels.settings).replaceWith(s),n.setupPanels(),n.swapPanel(t)},n.setupPanels=function(){_.MTAccordion({target:".accordion"});var e=p(document.getElementById("tribe-event-datepickers")),a=p(document.getElementById("ticket_start_date")),n=p(document.getElementById("ticket_end_date"));p(document.getElementById("ticket_start_time")),p(document.getElementById("ticket_end_time"));if("undefined"==typeof tribe_datepicker_opts){var t=p("[data-datepicker_format]"),i=t.length?t.attr("data-datepicker_format"):"",r=parseInt(i,10);isNaN(r)||(_.tribe_datepicker_opts={dateFormat:f[r]})}var c=_.tribe_datepicker_opts||{};if(e.length&&e.data("startofweek"),"undefined"!=typeof tribe_ticket_datepicker_format){var d=p.isNumeric(tribe_ticket_datepicker_format.datepicker_format_index)?tribe_ticket_datepicker_format.datepicker_format_index:0;k=f[d]}else c&&c.dateFormat&&(k=c.dateFormat);var o={dateFormat:k,showAnim:"fadeIn",changeMonth:!0,changeYear:!0,numberOfMonths:3,showButtonPanel:!1,onChange:function(){},beforeShow:function(e,t){t.input.data("prevDate",t.input.datepicker("getDate"));var i=p(t.dpDiv);i.addClass("tribe-ui-datepicker"),i.attrchange({trackValues:!0,callback:function(e){(0<=e.newValue.indexOf("display: none")||0<=e.newValue.indexOf("display:none"))&&i.removeClass("tribe-ui-datepicker")}})},onSelect:function(e,t){var i=p.datepicker.parseDate(k,e);"ticket_start_date"===t.id?n.datepicker("option","minDate",i):a.datepicker("option","maxDate",i)}};p.extend(o,tribe_l10n_datatables.datepicker);var s=m.find(".tribe-timepicker:not(.ui-timepicker-input)");if(tribe_timepickers.setup_timepickers(s),a.datepicker(o).datepicker("option","defaultDate",p(document.getElementById("EventStartDate")).val()).keyup(function(e){8!==e.keyCode&&46!==e.keyCode||p.datepicker._clearDate(this)}),n.datepicker(o).datepicker("option","defaultDate",p(document.getElementById("EventEndDate")).val()).keyup(function(e){8!==e.keyCode&&46!==e.keyCode||p.datepicker._clearDate(this)}),p(document.getElementById("tribe_ticket_header_preview")).find("img").length){p(document.getElementById("tribe_ticket_header_remove")).show();var l=p(document.getElementById("tribe_ticket_header_preview")).find("img");l.removeAttr("width").removeAttr("height"),m.width()<l.width()&&l.css("width","95%")}"undefined"!=typeof tribe_event_tickets_plus&&p.isPlainObject(tribe_event_tickets_plus)&&p.isPlainObject(tribe_event_tickets_plus.meta)&&p.isPlainObject(tribe_event_tickets_plus.meta.admin)&&p.isFunction(tribe_event_tickets_plus.meta.admin.init_ticket_fields)&&tribe_event_tickets_plus.meta.admin.init_ticket_fields(),tribe.tickets.table&&0!==u.find(".tribe-tickets-editor-table-tickets-body tr").length&&tribe.tickets.table.toggle_sortable(),m.find(tribe.validation.selectors.item).validation(),m.find(".tribe-dependent").dependency(),m.find(".tribe-dependency").trigger("verify.dependency")},a.ajaxSend(function(e,t,i){"string"===p.type(i.data)&&-1!==i.data.indexOf("action=tribe-ticket")&&m.trigger("spin.tribe","start")}),a.ajaxComplete(function(e,t,i){"string"===p.type(i.data)&&-1!==i.data.indexOf("action=tribe-ticket")&&m.trigger("spin.tribe","stop")}),a.on({"spin.tribe":function(e,t){(void 0===t||p.inArray(t,["start","stop"]))&&(t="stop"),"stop"===t?(i.hide(),d.removeClass("is-active")):(i.show(),d.addClass("is-active"))}}),t.on("click",function(e){p(_).off("beforeunload.tribe")}),a.on("click","#settings_form_toggle",function(e){return e.preventDefault(),n.fetchPanels(null,"settings"),!1}),a.on("click","#tribe_settings_form_cancel, #ticket_form_cancel",function(e){return e.preventDefault(),n.fetchPanels(null,"list"),!1}),a.on("click","#tribe_settings_form_save",function(e){e.preventDefault();var t=s.find("input,textarea").serialize();return n.fetchPanels(t,"list"),!1}),a.on("click",".ticket_form_toggle",function(e){return e.preventDefault(),function(e){void 0===e&&(e=!0);var t,i=m.find(".tribe-ticket-editor-field-default_provider");i.is(":radio")&&(i=i.filter(":checked")),t=e?"Tribe__Tickets__RSVP_radio":"Tribe__Tickets_Plus__Commerce__WooCommerce__Main_radio",!e&&0<i.length&&(t=i.val()+"_radio"),p(document.getElementById(t)).prop("checked",!0).trigger("change")}("rsvp_form_toggle"===p(this).attr("id")),o.find(".tribe-dependency").trigger("verify.dependency"),n.swapPanel("ticket"),!1}),a.on("click",".ticket_edit_button",function(e){e.preventDefault();var t=p(this),i={action:"tribe-ticket-edit",post_id:r.val(),ticket_id:t.data("ticketId"),nonce:TribeTickets.edit_ticket_nonce,is_admin:p("body").hasClass("wp-admin")};return p.post(ajaxurl,i,function(e){e.success&&(n.refreshPanels(e.data,"ticket"),n.startWatchingMoveLinkIn("#event_tickets"))},"json"),!1}),a.on("click.tribe",'[name="ticket_form_save"]',function(e){var t=p(document.getElementById("ticket_form_table"));if(t.trigger("validation.tribe"),!tribe.validation.hasErrors(t)){m.trigger("pre-save-ticket.tribe",e);var i=u.find(".tribe-ticket-field-order"),a={action:"tribe-ticket-add",data:o.find("input,textarea").serialize(),post_id:r.val(),nonce:TribeTickets.add_ticket_nonce,menu_order:i.length,is_admin:p("body").hasClass("wp-admin")};p.post(ajaxurl,a,function(e){e.success&&n.refreshPanels(e.data)},"json")}}),a.on("click",".ticket_delete",function(e){if(!confirm(tribe_ticket_notices.confirm_alert))return!1;e.preventDefault(),m.trigger("delete-ticket.tribe",e);var t=p(this).attr("attr-ticket-id"),i={action:"tribe-ticket-delete",post_id:r.val(),ticket_id:t,nonce:TribeTickets.remove_ticket_nonce,is_admin:p("body").hasClass("wp-admin")};p.post(ajaxurl,i,function(e){e.success&&n.refreshPanels(e.data)},"json")}),a.on("change",".tribe-ticket-field-capacity",function(e){var t=p(this),i=t.parents(".input_block").eq(0).find(".tribe-ticket-field-mode");t.val()&&i.val("capped")}),a.on("keyup","#ticket_price",function(e){e.preventDefault();var t=price_format.decimal,i=new RegExp("[^-0-9%\\"+t+"]+","gi"),a=p(this).val(),n=a.replace(i,"");a!==n&&p(this).val(n)}),a.on("click","#tribe_ticket_header_image, #tribe_ticket_header_preview",function(e){e.preventDefault(),ticketHeaderImage.uploader("","")}),a.on("focus","#settings_global_capacity_edit",function(){var e=p(this),t=0;p(".tribe-tickets-editor-capacity-table").find("[data-capacity]").each(function(){var e=p(this);t+=parseInt(e.data("capacity"),10)}),e.data("nonSharedCapacity",t)}),a.on("blur change","#settings_global_capacity_edit",function(){var e=p(".tribe-tickets-editor-table-row-capacity-total");if(-1!==parseInt(e.data("totalCapacity"),10)){var t=p(this),i=e.find(".tribe-tickets-editor-total-capacity"),a=parseInt(t.val(),10),n=t.data("nonSharedCapacity");(""===a||a<0||c.isNaN(a))&&(a=0);var r=n+a;i.text(r)}}),a.on("click","#global_capacity_edit_button",function(e){e.preventDefault(),p(document.getElementById("settings_global_capacity_edit")).prop("disabled",!1).focus()}),a.on("blur",'[name="tribe-ticket[event_capacity]"]',function(e,t){void 0===t&&(t=p(this).val());if(void 0!==t){t||(t=0),t=parseInt(t,10);var i=p(".tribe-ticket-capacity-max").find(".tribe-ticket-capacity-value"),a=p('.tribe-ticket-field-capacity[name="tribe-ticket[capacity]"]');a.attr("placeholder",t),t?a.attr("max",t):t=0,i.text(t)}}),a.on("change",'[name="tribe-ticket[capacity]"]',function(e){var t=p(this),i=parseInt(t.attr("max"),10),a=parseInt(t.val(),10);i&&i<a&&t.val(i)}),a.on("click","#tribe_ticket_header_remove",function(e){e.preventDefault(),p(document.getElementById("tribe_ticket_header_preview")).html(""),p(document.getElementById("tribe_ticket_header_remove")).hide(),p(document.getElementById("tribe_tickets_image_preview_filename")).hide().find(".filename").text(""),p(document.getElementById("tribe_ticket_header_image_id")).val("")}),a.ready(function(){n.setupPanels()})}}(window,jQuery,_,tribe.tickets.editor);