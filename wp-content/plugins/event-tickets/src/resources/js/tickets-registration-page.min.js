"undefined"==typeof tribe&&(tribe={}),void 0===tribe.tickets&&(tribe.tickets={}),tribe.tickets.registration={},function(t,e){"use strict";e.document=t(document),e.hasChanges={},e.selector={footerQuantity:".tribe-tickets__footer__quantity__number",footerAmount:".tribe-tickets__footer__total .tribe-amount",checkout:".tribe-tickets__registration__checkout",checkoutButton:".tribe-tickets__item__registration__submit",container:".tribe-tickets__registration",eventContainer:".tribe-tickets__registration__event",field:{text:".tribe-tickets__item__attendee__field__text",checkbox:".tribe-tickets__item__attendee__field__checkbox",select:".tribe-tickets__item__attendee__field__select",radio:".tribe-tickets__item__attendee__field__radio"},fields:".tribe-tickets__item__attendee__fields",fieldsError:".tribe-tickets__item__attendee__fields__error",fieldsErrorAjax:".tribe-tickets__item__attendee__fields__error--ajax",fieldsErrorRequired:".tribe-tickets__item__attendee__fields__error--required",fieldsSuccess:".tribe-tickets__item__attendee__fields__success",form:"#tribe-tickets__registration__form",item:".tribe-tickets__item",itemPrice:".tribe-amount",itemQuantity:".tribe-ticket-quantity",loader:".tribe-common-c-loader",metaField:".ticket-meta",metaItem:".tribe-ticket",metaForm:".tribe-tickets__registration__content",miniCart:"#tribe-tickets__mini-cart",status:".tribe-tickets__registration__status",toggler:".tribe-tickets__registration__toggle__handler"};var i=t(e.selector.container);t(e.selector.eventContainer).length&&(e.commerceSelector={edd:"Tribe__Tickets_Plus__Commerce__EDD__Main",rsvp:"Tribe__Tickets__RSVP",tpp:"Tribe__Tickets__Commerce__PayPal__Main",Tribe__Tickets__Commerce__PayPal__Main:"tribe-commerce",Tribe__Tickets__RSVP:"rsvp",Tribe__Tickets_Plus__Commerce__EDD__Main:"edd",Tribe__Tickets_Plus__Commerce__WooCommerce__Main:"woo",tribe_eddticket:"edd",tribe_tpp_attendees:"tpp",tribe_wooticket:"woo",woo:"Tribe__Tickets_Plus__Commerce__WooCommerce__Main"},e.provider=i.data("provider"),e.providerId=e.commerceSelector[e.provider],e.getMetaForSave=function(){var i=t(e.selector.metaForm).find(e.selector.metaItem),r=[],o=[];return i.each(function(){var i={},r=t(this),n=r.data("ticketId"),c=r.find(e.selector.metaField);c.length&&(o[n]||(o[n]={},o[n].ticket_id=n,o[n].items=[]),c.each(function(){var e=t(this),r=e.val(),o=e.is(":radio"),n=e.attr("name");if(n=(n=n.split("[")).pop().replace("]",""),(o||e.is(":checkbox"))&&!e.prop("checked")){if(o&&""!==i[n])return;r=""}i[n]=r}),o[n].items.push(i))}),Object.keys(o).forEach(function(t){var e={ticket_id:t,items:o[t].items};r.push(e)}),r},e.getTicketsForSave=function(){var i=[],r=t(e.selector.miniCart);return r.length||(r=t(e.selector.container)),r.find(e.selector.item).each(function(){var r=t(this),o=r.data("ticketId"),n=r.find(e.selector.itemQuantity).text(),c={};c.ticket_id=o,c.quantity=n,i.push(c)}),i},e.initFormPrefills=function(){t.ajax({type:"GET",data:{provider:e.providerId,post_id:e.postId},dataType:"json",url:e.getRestEndpoint(),success:function(i){i.tickets&&e.prefillCartForm(t(e.selector.miniCart),i.tickets),i.meta&&(e.appendARFields(i),e.prefillMetaForm(i))},complete:function(){e.loaderHide()}})},e.appendARFields=function(r){var o=r.tickets,n=r.meta,c=0,a=0;t.each(o,function(t,e){n.filter(t=>t.ticket_id===e.ticket_id);var r=window.wp.template("tribe-registration--"+e.ticket_id),o=i.find('.tribe-tickets__item__attendee__fields__container[data-ticket-id="'+e.ticket_id+'"]');o.length?a+=e.quantity:c+=e.quantity,o.addClass("tribe-tickets--has-tickets");for(var _=1;_<=e.quantity;++_){var s={attendee_id:_};try{o.append(r(s))}catch(t){}}}),e.maybeShowNonMetaNotice(c,a)},e.maybeShowNonMetaNotice=function(e,i){var r=t(".tribe-tickets__notice--non-ar");0<e&&0<i?(t("#tribe-tickets__non-ar-count").text(e),r.removeClass("tribe-common-a11y-hidden")):r.addClass("tribe-common-a11y-hidden")},e.prefillMetaForm=function(e,r){if(!(void 0===e||0>=e.length)){if(void 0===r)r=0;var o=i.find(".tribe-tickets__item__attendee__fields__container"),n=e.meta;if(0<r)n=n.splice(0,r-1);t.each(n,function(e,i){var r=o.filter(`[data-ticket-id="${i.ticket_id}"]`);if(r.length){var n=0;t.each(i.items,function(e,i){if("object"==typeof i){var o=r.find(".tribe-ticket");t.each(i,function(e,i){var r=o.eq(n).find(`[name*="${e}"]`);r.is(":radio")||r.is(":checkbox")?r.each(function(e){var r=t(this);i===r.val()&&r.prop("checked",!0)}):r.val(i)}),n++}})}})}},e.updateFooter=function(){e.updateFooterCount(),e.updateFooterAmount()},e.updateFooterCount=function(){var i=t(e.selector.miniCart),r=i.find(e.selector.footerQuantity),o=0;i.find(e.selector.itemQuantity).each(function(){var e=parseInt(t(this).text(),10);e=isNaN(e)?0:e,o+=e}),0>o||r.text(o)},e.updateFooterAmount=function(){var i=t(e.selector.miniCart),r=i.find(e.selector.footerAmount),o=0;i.find(e.selector.itemQuantity).each(function(){var i=t(this),r=i.closest(e.selector.item).find(e.selector.itemPrice).first(0),n=parseInt(i.text(),10);n=isNaN(n)?0:n;var c=e.cleanNumber(r.text())*n;o+=c}),0>o||r.text(e.numberFormat(o))},e.prefillCartForm=function(i,r){t.each(r,function(t,r){var o=i.find('[data-ticket-id="'+r.ticket_id+'"]');if(o){var n=o.find(".tribe-tickets__item__extra__price .tribe-amount").text();o.find(".tribe-ticket-quantity").html(r.quantity);var c=r.quantity*e.cleanNumber(n);c=e.numberFormat(c),o.find(".tribe-tickets__item__total .tribe-amount").html(c)}}),e.updateFooter()},e.validateForm=function(i){var r=i.find(e.selector.metaItem),o=!0,n=0;return r.each(function(){var i=t(this);e.validateBlock(i)||(n++,o=!1)}),[o,n]},e.validateBlock=function(i){var r=i.find(e.selector.metaField),o=!0;return r.each(function(){var i=t(this);e.validateField(i[0])||(o=!1)}),o?i.removeClass("tribe-ticket-item__has-error"):i.addClass("tribe-ticket-item__has-error"),o},e.validateCheckboxRadioGroup=function(i){var r=i.find(e.selector.metaField),o=!1,n=!0;return r.each(function(){var e=t(this);e.is(":checked")&&(o=!0),e.prop("required")||(n=!1)}),!n||o},e.validateField=function(i){var r=!0,o=t(i);if(!(r=i.checkValidity()))if((o=t(i)).is(":checkbox")||o.is(":radio")){var n=o.closest(".tribe-common-form-control-checkbox-radio-group");n.length&&(r=e.validateCheckboxRadioGroup(n))}else r=!1;return r?o.removeClass("ticket-meta__has-error"):o.addClass("ticket-meta__has-error"),r},e.focusTicketBlock=function(i){t(i).closest(e.selector.metaItem).addClass("tribe-ticket-item__has-focus")},e.unfocusTicketBlock=function(i){t(i).closest(e.selector.metaItem).removeClass("tribe-ticket-item__has-focus")},e.loaderShow=function(){t(e.selector.loader).removeClass("tribe-common-a11y-hidden")},e.loaderHide=function(){t(e.selector.loader).addClass("tribe-common-a11y-hidden")},e.getRestEndpoint=function(){return TribeCartEndpoint.url},e.getCurrencyFormatting=function(){return JSON.parse(TribeCurrency.formatting)[e.commerceSelector[e.providerId]]},e.cleanNumber=function(t){var i=e.getCurrencyFormatting();if(i.thousands_sep===i.decimal_point){var r=t.length-(i.number_of_decimals+1);t=(t=(t=t.substr(0,r)+"_"+t.substr(r+1)).split(i.thousands_sep).join("")).split("_").join(".")}else t=(t=t.split(i.thousands_sep).join("")).split(i.decimal_point).join(".");return t},e.numberFormat=function(t){var i=e.getCurrencyFormatting();if(!i)return!1;var r=i.number_of_decimals,o=i.decimal_point,n=i.thousands_sep,c=isFinite(+t)?+t:0,a=isFinite(+r)?Math.abs(r):0,_=void 0===n?",":n,s=void 0===o?".":o,d=(a?function(t,e){var i=Math.pow(10,e);return Math.round(t*i)/i}(c,a):Math.round(c)).toString().split(s);return d[0].length>3&&(d[0]=d[0].replace(/\B(?=(?:\d{3} )+(?!\d))/g,_)),(d[1]||"").length<a&&(d[1]=d[1]||"",d[1]+=new Array(a-d[1].length+1).join("0")),d.join(s)},e.document.on("focus",".tribe-ticket .ticket-meta",function(t){var i=t.target;e.focusTicketBlock(i)}),e.document.on("blur",".tribe-ticket .ticket-meta",function(t){var i=t.target;e.unfocusTicketBlock(i)}),e.document.on("click",e.selector.checkoutButton,function(i){i.preventDefault();t(this);var r=t(e.selector.metaForm),o=t(".tribe-tickets__notice--error"),n=e.validateForm(r);if(!n[0])return t([document.documentElement,document.body]).animate({scrollTop:t(".tribe-tickets__registration").offset().top},"slow"),t(".tribe-tickets__notice--error__count").text(n[1]),o.show(),!1;o.hide(),e.loaderShow();var c={tribe_tickets_provider:e.commerceSelector[e.tribe_ticket_provider],tribe_tickets_tickets:e.getTicketsForSave(),tribe_tickets_meta:e.getMetaForSave(),tribe_tickets_post_id:e.postId};t("#tribe_tickets_ar_data").val(JSON.stringify(c)),t(e.selector.form).submit()}),e.init=function(){e.loaderShow(),e.initFormPrefills()},e.document.on("ready",function(t){e.init()}))}(jQuery,tribe.tickets.registration);