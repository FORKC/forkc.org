var tribe_move_tickets=tribe_move_tickets||{};!function(r,t){var d,a,i,_,o,p,s,v,l,m,n,k;function f(t){o=(_=t).attr("id"),p.hide(),_.show(),d.trigger("pre-activate-stage.tribe"),d.trigger("activate-"+o+".tribe")}function u(t){0<(t=parseInt(t,10))&&n!==t&&(n=t,d.trigger("destination-post-selected.tribe"))}function b(t,e){e===o&&(t.removeProp("disabled").show().removeClass("disabled"),"next"===t.attr("id")&&y()&&t.addClass("button-primary"))}function h(t,e){e===o&&t.prop("disabled",!0).addClass("disabled").removeClass("button-primary")}function g(t,e){e===o&&t.hide()}function y(){return!_.next(".stage").length}t.get_main_element=function(){return d},t.hide_btn=g,t.disable_btn=h,t.enable_btn=b,t.activate_stage=f,r(document).ready(function(){d=r("#main"),i=r(".error"),a=r("#processing"),s=r("#back"),v=r("#next"),d.trigger("move-tickets-dialog-pre-init.tribe"),s.add(v).hide(),a.hide(),i.length||(v.show(),function(){var t,c=r("#choose-event").find(".select-single-container"),i=r("#post-type"),e=r("#search-terms"),a="choose-event",s=!1;function o(){if(!s){s=!0,c.css("opacity",.6),h(v,a);var t={action:"move_tickets_get_post_choices",check:tribe_move_tickets_data.check,post_type:i.val(),search_terms:e.val(),ignore:tribe_move_tickets_data.src_post_id};r.post(ajaxurl,t,function(t){if(void 0!==t.data&&"object"==typeof t.data.posts){c.html("");var e=0;for(var i in t.data.posts){var a=parseInt(i,10),o=t.data.posts[i];e++,c.append('<label> <input type="radio" value="'+a+'" name="post-choice">'+o+"</label>")}e||c.append("<label>"+tribe_move_tickets_data.no_posts_found+"</label>"),s=!1,c.css("opacity",1)}})}}function n(){var t=c.find("input:checked");c.find(".selected").removeClass("selected"),t.length&&(u(t.val()),t.parent("label").addClass("selected"),b(v,a))}d.on("activate-choose-event.tribe",function(){h(v,a),m&&"next"===l?f(_.next()):m&&f(p.first()),n()}),function(){i.html('<option value="">'+tribe_move_tickets_data.loading_msg+"</option>");var t={action:"move_tickets_get_post_types",check:tribe_move_tickets_data.check};r.post(ajaxurl,t,function(t){if(void 0!==t.data&&"object"==typeof t.data.posts)for(var e in i.html(""),t.data.posts)i.append('<option value="'+e+'">'+t.data.posts[e]+"</option>")})}(),o(),e.keyup(function(){clearTimeout(t),t=setTimeout(o,200)}),i.change(o),c.click(function(){s||n()})}(),"move_tickets"===tribe_move_tickets_data.mode?(function(){var e="move-where",i=r('input[name="move-where"]');function t(){var t=i.filter(":checked");t.length?(m="this-post"===t.val()?(u(tribe_move_tickets_data.src_post_id),!0):n=!1,b(v,e)):h(v,e)}d.on("activate-move-where.tribe",function(){g(s,e),t()}),i.change(t)}(),e="choose-ticket-type",c=r("#choose-ticket-type").find(".select-single-container"),d.on("activate-choose-ticket-type.tribe",function(){h(v,e),n||f(p.first())}),d.on("destination-post-selected.tribe",function(){c.css("opacity",.6),h(v,e);var t={action:"move_tickets_get_ticket_types",check:tribe_move_tickets_data.check,post_id:n,provider:tribe_move_tickets_data.provider,ticket_ids:tribe_move_tickets_data.ticket_ids};r.post(ajaxurl,t,function(t){if("object"==typeof t.data.posts){c.html("");var e=0;for(var i in t.data.posts){var a=parseInt(i,10),o=t.data.posts[i];e++,c.append('<label> <input type="radio" value="'+a+'" name="post-choice">'+o+"</label>")}e||c.append("<label>"+tribe_move_tickets_data.no_ticket_types_found+"</label>"),c.css("opacity",1)}})}),c.click(function(){var t=c.find("input:checked");c.find(".selected").removeClass("selected"),t.length&&(k=parseInt(t.val()),t.parent("label").addClass("selected"),b(v,e))})):(r("#move-where").remove(),r("#choose-ticket-type").remove()),p=r(".stage"),function(){var t=v.html(),e=v.data("final-text");function i(t){var e=_[l=t](".stage");e.length?f(e):y()&&d.trigger("move-tickets-final-stage.tribe")}e=e||t,d.on("pre-activate-stage.tribe",function(){v.html(y()?e:t)}),s.add(v).click(function(){switch(r(this).attr("id")){case"back":i("prev");break;case"next":i("next")}})}(),function(){function e(t){if(void 0!==t.data&&"string"==typeof t.data.message){if(a.html(t.data.message),"string"==typeof t.data.redirect_top){var e="number"==typeof t.data.redirect_top_delay?t.data.redirect_top_delay:2e3;setTimeout(function(){top.location=t.data.redirect_top},e)}"number"==typeof t.data.remove_ticket_type&&top.jQuery("table.ticket_list").find('tr[data-ticket-type-id="'+t.data.remove_ticket_type+'"]').remove(),top.jQuery("#ticket_form_cancel").trigger("click"),r.isArray(t.data.remove_tickets)&&top.tribe_event_tickets_attendees.remove_tickets(t.data.remove_tickets)}else i()}function i(){a.html(tribe_move_tickets_data.unexpected_failure)}d.on("move-tickets-final-stage.tribe",function(){switch(tribe_move_tickets_data.mode){case"move_tickets":!function(){if(n&&k){var t={action:"move_tickets",src_post_id:tribe_move_tickets_data.src_post_id,target_post_id:n,check:tribe_move_tickets_data.check,ticket_ids:tribe_move_tickets_data.ticket_ids,target_type_id:k};p.hide(),s.hide(),v.hide(),a.show(),r.post(ajaxurl,t,function(t){e(t)}).fail(i)}}();break;case"ticket_type_only":!function(){if(n){var t={action:"move_ticket_type",src_post_id:tribe_move_tickets_data.src_post_id,ticket_type_id:tribe_move_tickets_data.ticket_type_id,target_post_id:n,check:tribe_move_tickets_data.check};p.hide(),s.hide(),v.hide(),a.show(),r.post(ajaxurl,t,function(t){e(t)}).fail(i)}}()}})}(),f(p.first())),d.trigger("move-tickets-dialog-post-init.tribe");var e,c})}(jQuery,tribe_move_tickets);