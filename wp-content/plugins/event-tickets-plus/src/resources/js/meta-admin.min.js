var tribe_event_tickets_plus=tribe_event_tickets_plus||{};tribe_event_tickets_plus.meta=tribe_event_tickets_plus.meta||{},tribe_event_tickets_plus.meta.admin=tribe_event_tickets_plus.meta.admin||{},tribe_event_tickets_plus.meta.admin.event=tribe_event_tickets_plus.meta.admin.event||{},function(e,s,d,n){"use strict";n.init=function(){n.$tribe_tickets=d(s.getElementById("tribetickets")),n.$event_tickets=d(s.getElementById("event_tickets")),n.$event_tickets.on("change","input.show_attendee_info",n.event.toggle_linked_form).on("change",".save_attendee_fieldset",n.event.toggle_linked_form),n.$tribe_tickets.on("change",".ticket-attendee-info-dropdown",n.event.select_saved_fieldset).on("click",".meta-postbox .hndle, .meta-postbox .handlediv",n.event.click_postbox).on("click","a.add-attendee-field",n.event.add_field).on("click","a.delete-attendee-field",n.event.remove_field).on("edit-ticket.tribe",n.event.edit_ticket).on("saved-ticket.tribe",n.event.saved_ticket),n.init_ticket_fields(),n.$event_tickets.trigger("event-tickets-plus-meta-initialized.tribe")},n.init_ticket_fields=function(){n.$event_tickets||(n.$event_tickets=d(s.getElementById("event_tickets"))),n.init_custom_field_sorting(),n.maybe_hide_saved_fields_select(),n.$event_tickets.trigger("event-tickets-plus-ticket-meta-initialized.tribe",{ticket_id:n.$event_tickets.find("#ticket_id").val()})},n.init_custom_field_sorting=function(){d(s.getElementById("tribe-tickets-attendee-sortables")).sortable({containment:"parent",items:"> div",tolerance:"pointer",connectWith:"#tribe-tickets-attendee-sortables"})},n.toggle_linked_form=function(e){var t=d(),i=e.data("tribe-toggle");i&&(t=d(s.getElementById(i))),e.is(":checked")?t.show():t.hide()},n.maybe_hide_saved_fields_select=function(){d(".tribe-tickets-attendee-info-active-field").length?d(".tribe-tickets-attendee-saved-fields").hide():d(".tribe-tickets-attendee-saved-fields").show()},n.fetch_saved_fields=function(e){var t={action:"tribe-tickets-load-saved-fields",fieldset:e};return d.post(ajaxurl,t,"json")},n.inject_saved_fields=function(t){var e=n.fetch_saved_fields(t);e.done(function(e){e.success?(d(s.getElementById("tribe-tickets-attendee-sortables")).append(e.data),n.maybe_hide_saved_fields_select(),n.$event_tickets.trigger("event-tickets-plus-fieldset-loaded.tribe",{fieldset_id:t})):n.$event_tickets.trigger("event-tickets-plus-fieldset-load-failure.tribe",{fieldset_id:t})}),e.fail(function(){n.$event_tickets.trigger("event-tickets-plus-fieldset-load-failure.tribe",{fieldset_id:t})})},n.add_field=function(t){var e={action:"tribe-tickets-info-render-field",type:t},i=d.post(ajaxurl,e,"json");i.done(function(e){e.success?(d(s.getElementById("tribe-tickets-attendee-sortables")).append(e.data),n.maybe_hide_saved_fields_select(),n.$event_tickets.trigger("event-tickets-plus-field-added.tribe",{type:t})):n.$event_tickets.trigger("event-tickets-plus-field-add-failure.tribe",{type:t})}),i.fail(function(){n.$event_tickets.trigger("event-tickets-plus-field-add-failure.tribe",{type:t})})},n.remove_field=function(e){var t="";t="undefined"!==e[0].outerHTML?e[0].outerHTML:d("<div>").append(e.eq(0).clone()).html(),e.remove(),n.maybe_hide_saved_fields_select(),n.$event_tickets.trigger("event-tickets-plus-field-removed.tribe",{field:t})},n.toggle_postbox=function(e){e.toggleClass("closed")},n.event.toggle_linked_form=function(){n.toggle_linked_form(d(this))},n.event.select_saved_fieldset=function(){var e=d(this).val();e&&0!==parseInt(e,10)&&n.inject_saved_fields(e)},n.event.add_field=function(e){e.preventDefault(),n.add_field(d(this).data("type"))},n.event.remove_field=function(e){e.preventDefault(),n.remove_field(d(this).closest(".meta-postbox"))},n.event.edit_ticket=function(){n.init_ticket_fields()},n.event.click_postbox=function(){n.toggle_postbox(d(this).closest(".meta-postbox"))},n.event.saved_ticket=function(e,t){if(void 0!==t.fieldsets&&t.success){var i=d(s.getElementById("saved_ticket-attendee-info"));i.find('option:not([value="0"])').remove();for(var n=0;n<t.fieldsets.length;n++)i.append('<option value="'+t.fieldsets[n].ID+'" data-attendee-group="'+t.fieldsets[n].post_name.replace('"','\\"')+'">'+t.fieldsets[n].post_name+"</option>")}},d(function(){n.init()})}(window,document,jQuery,tribe_event_tickets_plus.meta.admin);